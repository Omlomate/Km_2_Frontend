import React, { useState, useEffect } from "react";
import LoginPage from "../Login&Registation/loginForm";
import { isAuthenticated } from "../../utils/auth"; // Import isAuthenticated
import "./navbar.css";
import { Link } from "react-router-dom";

const Navbar = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [isLoginVisible, setIsLoginVisible] = useState(false);
  const [loggedIn, setLoggedIn] = useState(false); // State to track authentication

  useEffect(() => {
    setLoggedIn(isAuthenticated()); // Check if user is authenticated on component mount
  }, []);

  const toggleNavbar = () => {
    setIsOpen(!isOpen);
  };

  const showLogin = () => {
    setIsLoginVisible(true);
  };

  const hideLogin = () => {
    setIsLoginVisible(false);
  };

  const userData = JSON.parse(localStorage.getItem("userData"));

  const handleLogout = () => {
    // ✅ Remove all relevant data from localStorage
    localStorage.clear(); // Clears all stored keys

    // ✅ Clear sessionStorage if any session data exists
    sessionStorage.clear();

    // ✅ Reset authentication state
    setLoggedIn(false);

    // ✅ Optionally, clear cookies if authentication relies on them
    document.cookie.split(";").forEach((cookie) => {
      document.cookie = cookie
        .replace(/^ +/, "")
        .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
    });

    // ✅ Redirect user to login or home page
    window.location.href = "/login"; // OR use navigate("/login");
  };

  // useEffect(() => {
  //   console.log("isLoginVisible:", isLoginVisible);
  // }, [isLoginVisible]);

  return (
    <>
      <nav
        className="bg-white w-full px-8 md:px-auto shadow-sm transition-all duration-300"
        style={{ fontFamily: "wantedsans" }}
      >
        <div className="md:h-16 h-28 mx-auto md:px-4 container flex items-center justify-between flex-wrap md:flex-nowrap">
          <div className="flex items-center flex-shrink-0 text-gray-700 order-1 md:order-none md:mr-6 mx-auto md:mx-0">
            <a href="/" className="flex items-center gap-2 logo-hover">
              <svg
                className="w-8 h-8 md:w-10 md:h-10" // Responsive sizing
                viewBox="0 0 360 398"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M54.9577 182.394L2.36267 391.782C1.56966 394.939 3.95687 398 7.21202 398H352.001C355.867 398 359.001 394.866 359.001 391V0L234.236 195.991L183.814 100.814L109.115 240.666L54.9577 182.394Z"
                  fill="#12153D"
                />
                <path
                  d="M1 199V398H347.2C353.827 398 359.2 392.627 359.2 386V199L259.7 290.54L180.1 199L100.5 290.54L1 199Z"
                  fill="#E5590F"
                />
              </svg>
              <svg
                className="w-32 h-auto md:w-52" // Responsive sizing for text logo
                viewBox="0 0 208 34"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clipPath="url(#clip0_1094_135)">
                  <path
                    d="M0 26.83L0.586206 1.92053H5.09548L4.76051 11.7025H5.41113L13.7429 1.92053H18.9429L9.16027 14.1032L20.0534 26.83H13.7791L5.41113 16.6511H4.76051V26.83H0Z"
                    fill="#12153D"
                  />
                  <path
                    d="M27.0693 27.3357C25.2914 27.3357 23.7196 26.958 22.3604 26.209C21.0011 25.4536 19.9447 24.3909 19.1845 23.0209C18.4244 21.6445 18.0508 20.0248 18.0508 18.1619V17.733C18.0508 15.8701 18.4244 14.2504 19.1717 12.874C19.9189 11.4976 20.9625 10.4349 22.3088 9.68592C23.6552 8.93051 25.2205 8.5592 26.9985 8.5592C28.7764 8.5592 30.2838 8.94971 31.5786 9.72433C32.8799 10.499 33.8848 11.5745 34.6063 12.9508C35.3277 14.3272 35.6885 15.9213 35.6885 17.7394V19.2822H22.6631C22.7082 20.4986 23.1656 21.4909 24.0352 22.2591C24.8984 23.0273 25.9613 23.405 27.2111 23.405C28.4608 23.405 29.4206 23.1297 30.0261 22.5792C30.6252 22.0286 31.0826 21.4204 31.3982 20.7482L35.1152 22.6816C34.7802 23.3026 34.2906 23.9812 33.6529 24.7046C33.0151 25.4344 32.1648 26.0553 31.1084 26.5675C30.0519 27.0796 28.7056 27.3357 27.0693 27.3357ZM22.7018 15.9021H31.0697C30.9731 14.8778 30.5608 14.052 29.8264 13.431C29.0921 12.81 28.1387 12.4963 26.9598 12.4963C25.781 12.4963 24.7567 12.81 24.0352 13.431C23.3138 14.052 22.8693 14.8778 22.7018 15.9021Z"
                    fill="#12153D"
                  />
                  <path
                    d="M40.3137 34V30.0565H50.0537C50.7237 30.0565 51.0651 29.698 51.0651 28.981V24.4997H50.4145C50.2212 24.9094 49.9185 25.3127 49.5126 25.716C49.1004 26.1257 48.5528 26.4586 47.8506 26.7211C47.1549 26.9836 46.266 27.118 45.1837 27.118C43.7859 27.118 42.5683 26.8043 41.5248 26.1706C40.4812 25.5368 39.6695 24.6597 39.0898 23.533C38.51 22.4127 38.2266 21.1195 38.2266 19.6599V9.05212H42.7745V19.3014C42.7745 20.6394 43.103 21.6445 43.7665 22.3103C44.43 22.9825 45.3705 23.3154 46.6009 23.3154C47.9924 23.3154 49.0746 22.8544 49.8476 21.9326C50.6142 21.0107 51.0007 19.7303 51.0007 18.0787V9.05212H55.5486V29.986C55.5486 31.2024 55.1879 32.1755 54.4664 32.9053C53.7449 33.6351 52.7851 34 51.5805 34H40.3266H40.3137Z"
                    fill="#12153D"
                  />
                  <path
                    d="M60.6426 26.7211L58.1367 9.05212H62.646L64.2307 23.7891H64.8813L66.8847 14.3208C67.0586 13.4886 67.7995 12.8932 68.6562 12.8932H73.0109C73.8676 12.8932 74.602 13.4886 74.7824 14.3208L76.7858 23.7891H77.4364L79.0211 9.05212H83.5304L81.0245 26.7211C81.0181 26.7851 80.9601 26.8363 80.8957 26.8363H73.5842C73.5198 26.8363 73.4618 26.7915 73.4554 26.7275L71.1621 16.6511H70.5115L68.2182 26.7275C68.2053 26.7915 68.1538 26.8363 68.0893 26.8363H60.7779C60.7134 26.8363 60.6555 26.7851 60.649 26.7211H60.6426Z"
                    fill="#12153D"
                  />
                  <path
                    d="M94.5668 27.3358C92.7888 27.3358 91.1848 26.9773 89.7676 26.2603C88.3504 25.5433 87.2296 24.5062 86.4114 23.1426C85.5933 21.779 85.1875 20.1465 85.1875 18.2324V17.6562C85.1875 15.7421 85.5933 14.1096 86.4114 12.746C87.2296 11.3825 88.344 10.3454 89.7676 9.62836C91.1848 8.91136 92.7824 8.55286 94.5668 8.55286C96.3512 8.55286 97.9487 8.91136 99.3659 9.62836C100.783 10.3454 101.904 11.3825 102.722 12.746C103.54 14.1096 103.946 15.7485 103.946 17.6562V18.2324C103.946 20.1465 103.534 21.779 102.722 23.1426C101.904 24.5062 100.783 25.5433 99.3659 26.2603C97.9487 26.9773 96.3447 27.3358 94.5668 27.3358ZM94.5668 23.3218C95.9647 23.3218 97.1177 22.8737 98.0325 21.9774C98.9472 21.0812 99.4046 19.7944 99.4046 18.1236V17.7651C99.4046 16.0942 98.9537 14.8074 98.0518 13.9112C97.15 13.0149 95.9904 12.5668 94.5732 12.5668C93.156 12.5668 92.0223 13.0149 91.1075 13.9112C90.1928 14.8074 89.7354 16.0942 89.7354 17.7651V18.1236C89.7354 19.7944 90.1928 21.0812 91.1075 21.9774C92.0223 22.8737 93.1754 23.3218 94.5732 23.3218H94.5668Z"
                    fill="#12153D"
                  />
                  <path
                    d="M106.76 26.83V9.05218H111.231V11.0623H111.882C112.146 10.3453 112.584 9.82039 113.196 9.4875C113.808 9.15461 114.523 8.98816 115.341 8.98816H117.505V13.0021H115.27C114.117 13.0021 113.164 13.3094 112.423 13.9176C111.682 14.5257 111.302 15.4668 111.302 16.7343V26.8428H106.754L106.76 26.83Z"
                    fill="#12153D"
                  />
                  <path
                    d="M126.241 27.3357C124.824 27.3357 123.49 26.9836 122.253 26.2794C121.016 25.5752 120.024 24.5381 119.277 23.1809C118.53 21.8237 118.156 20.1721 118.156 18.2323V17.6562C118.156 15.7228 118.53 14.0711 119.277 12.7076C120.024 11.344 121.01 10.3133 122.234 9.60909C123.458 8.90489 124.798 8.55279 126.241 8.55279C127.323 8.55279 128.231 8.68082 128.966 8.93049C129.7 9.18017 130.293 9.50026 130.75 9.87796C131.207 10.2621 131.555 10.6654 131.794 11.0943H132.444V1.73486H136.992V26.83H132.522V24.6789H131.871C131.459 25.3511 130.827 25.9593 129.977 26.5099C129.127 27.0604 127.877 27.3357 126.241 27.3357ZM127.613 23.3922C129.011 23.3922 130.177 22.9441 131.111 22.0478C132.045 21.1515 132.515 19.8456 132.515 18.1235V17.765C132.515 16.0429 132.051 14.7369 131.124 13.8407C130.196 12.9444 129.024 12.4963 127.606 12.4963C126.189 12.4963 125.043 12.9444 124.108 13.8407C123.168 14.7369 122.704 16.0429 122.704 17.765V18.1235C122.704 19.8456 123.174 21.1515 124.108 22.0478C125.043 22.9441 126.215 23.3922 127.606 23.3922H127.613Z"
                    fill="#12153D"
                  />
                  <path
                    d="M140.523 26.83V1.73486H151.487C153.072 1.73486 154.457 2.01014 155.636 2.5607C156.815 3.11125 157.73 3.88587 158.38 4.89095C159.031 5.89604 159.353 7.08037 159.353 8.43756V8.86648C159.353 10.3709 158.992 11.5936 158.271 12.5219C157.549 13.4566 155.604 14.1352 154.547 14.5641V15.2107C155.507 15.2619 157.311 15.5884 157.839 16.1965C158.367 16.8047 158.631 17.6113 158.631 18.6164V26.8235H153.871V19.295C153.871 18.7189 153.723 18.2579 153.42 17.8994C153.117 17.5409 152.621 17.3617 151.925 17.3617H145.29V26.8235H140.53L140.523 26.83ZM145.284 13.0661H150.985C152.112 13.0661 153.001 12.7588 153.639 12.1506C154.277 11.5424 154.592 10.7358 154.592 9.73072V9.37222C154.592 8.36714 154.277 7.56051 153.652 6.95234C153.027 6.34416 152.138 6.03688 150.985 6.03688H145.284V13.0661Z"
                    fill="#E5590F"
                  />
                  <path
                    d="M167.647 27.3357C166.372 27.3357 165.232 27.1116 164.22 26.6699C163.209 26.2282 162.41 25.5816 161.824 24.7366C161.231 23.8915 160.941 22.8544 160.941 21.6381C160.941 20.4217 161.238 19.3974 161.824 18.5716C162.41 17.7458 163.228 17.1248 164.278 16.7087C165.322 16.2926 166.52 16.0813 167.866 16.0813H172.775V15.0762C172.775 14.2376 172.511 13.5526 171.983 13.0148C171.454 12.4771 170.611 12.2082 169.457 12.2082C168.304 12.2082 167.486 12.4643 166.932 12.9764C166.378 13.4886 166.018 14.1544 165.85 14.9674L161.637 16.6447C160.993 14.0839 162.417 11.8305 163.054 11.0751C163.692 10.3197 164.542 9.71152 165.618 9.24418C166.688 8.77685 167.995 8.54639 169.535 8.54639C171.893 8.54639 173.754 9.13535 175.126 10.3005C176.498 11.472 177.181 13.1685 177.181 15.3899V22.0222C177.181 22.7392 177.516 23.0977 178.193 23.0977H179.636V26.8235H176.608C175.191 26.8235 174.166 26.273 173.542 25.1783V24.4165H172.859C172.762 24.7045 172.543 25.0823 172.208 25.5432C171.873 26.0041 171.345 26.4202 170.623 26.7787C169.902 27.1372 168.916 27.3165 167.667 27.3165L167.647 27.3357ZM168.44 23.6803C169.715 23.6803 170.752 23.3282 171.558 22.624C172.363 21.9198 172.769 20.9787 172.769 19.8072V19.4487H168.188C167.345 19.4487 166.688 19.6279 166.204 19.9864C165.721 20.3449 165.483 20.8443 165.483 21.4908C165.483 22.1374 165.734 22.6624 166.243 23.0657C166.745 23.4754 167.48 23.6739 168.446 23.6739L168.44 23.6803Z"
                    fill="#E5590F"
                  />
                  <path
                    d="M172.582 34V30.1269H181.278C181.948 30.1269 182.29 29.7684 182.29 29.0514V9.05212H186.838V29.986C186.838 31.2024 186.477 32.1755 185.756 32.9053C185.034 33.6351 184.074 34 182.87 34H172.588H172.582Z"
                    fill="#E5590F"
                  />
                  <path
                    d="M196.026 26.9324C194.751 26.9324 193.611 26.7083 192.599 26.2666C191.588 25.8249 190.789 25.1783 190.203 24.3332C189.61 23.4882 189.32 22.4511 189.32 21.2348C189.32 20.0184 189.617 18.9941 190.203 18.1683C190.789 17.3425 191.607 16.7215 192.657 16.3054C193.701 15.8893 194.899 15.678 196.245 15.678H201.154V14.6729C201.154 13.8343 200.89 13.1493 200.362 12.6115C199.833 12.0738 198.989 11.8049 197.836 11.8049C196.683 11.8049 195.865 12.061 195.311 12.5731C194.757 13.0853 194.396 13.751 194.229 14.5641L190.016 16.2414C189.372 13.6806 190.795 11.4272 191.433 10.6718C192.071 9.91637 192.921 9.3082 193.997 8.84086C195.066 8.37353 196.374 8.14307 197.914 8.14307C200.271 8.14307 202.133 8.73203 203.505 9.89716C204.877 11.0687 205.56 12.7652 205.56 14.9866V21.6189C205.56 22.3359 205.895 22.6944 206.572 22.6944H208.014V26.4202H204.987C203.57 26.4202 202.545 25.8697 201.921 24.775V24.0131H201.238C201.141 24.3012 200.922 24.6789 200.587 25.1399C200.252 25.6008 199.724 26.0169 199.002 26.3754C198.281 26.7339 197.295 26.9132 196.046 26.9132L196.026 26.9324ZM196.819 23.2769C198.094 23.2769 199.131 22.9248 199.936 22.2206C200.742 21.5164 201.147 20.5754 201.147 19.4038V19.0453H196.567C195.723 19.0453 195.066 19.2246 194.583 19.5831C194.1 19.9416 193.862 20.4409 193.862 21.0875C193.862 21.7341 194.113 22.2591 194.622 22.6624C195.124 23.0721 195.859 23.2705 196.825 23.2705L196.819 23.2769Z"
                    fill="#E5590F"
                  />
                  <path
                    d="M186.755 7.02004H182.246L182.246 2.62732H186.756L186.755 7.02004Z"
                    fill="#E5590F"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_1094_135">
                    <rect width="208" height="34" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </a>
          </div>
          <div className="text-gray-500 order-3 w-full md:w-auto md:order-2">
            <ul className="flex font-semibold justify-between items-center">
              {/* <li className="md:px-4 md:py-2">
                <a href="#" className="nav-link">Homepage</a>
              </li> */}
              <li className="md:px-4 md:py-2">
                <Link to="/blog" className="nav-link">
                  Blog
                </Link>
              </li>
              <li className="md:px-4 md:py-2">
                <a href="#" className="nav-link">
                  Forum
                </a>
              </li>
              <li className="md:px-4 md:py-2">
                <a href="#" className="nav-link">
                  Course
                </a>
              </li>
              <li className="md:px-4 md:py-2">
                {userData?.isAdmin && (
                  <a href="/admin-dashboard" className="nav-link">
                    Admin
                  </a>
                )}
              </li>
            </ul>
          </div>
          <div className="order-2 md:order-3">
            {loggedIn ? (
              <button
                onClick={handleLogout}
                className="nav-button px-4 py-2 hover:bg-[#12153D] bg-[#12153de8] text-gray-50 rounded-xl flex items-center gap-2 cursor-pointer transform hover:scale-105"
              >
                <span>Logout</span>
              </button>
            ) : (
              <button
                onClick={showLogin}
                className="nav-button px-4 py-2 bg-orange-400 hover:bg-orange-500 text-gray-50 rounded-xl flex items-center gap-2 cursor-pointer transform hover:scale-105"
              >
                <span>Login</span>
              </button>
            )}
          </div>
        </div>
      </nav>
      {isLoginVisible && (
        <LoginPage isVisible={isLoginVisible} onClose={hideLogin} />
      )}
    </>
  );
};

export default Navbar;
